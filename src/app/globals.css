@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  /* Fonts - base families */
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);

  /* Fonts - semantic slots (3-slot typography system)
     Title: Page titles, project names, section headers
     Terminal: Navigation, tabs, badges, labels (system UI)
     Body: Prose content, descriptions, paragraphs */
  --font-title: var(--font-geist-mono);
  --font-terminal: var(--font-geist-mono);
  --font-body: var(--font-ibm-plex-sans);

  /* Shadows - actual values defined in :root, referenced here for Tailwind theming.
     Unlike colors (which need rgb() wrapper), shadows are complete CSS values. */
  --shadow-sm: var(--shadow-sm);
  --shadow-md: var(--shadow-md);
  --shadow-lg: var(--shadow-lg);

  /* Fluid typography — headings scale down on narrower viewports
     Max values match Tailwind v4 defaults (desktop design stays unchanged).
     Min values reduce proportionally for viewports below ~1920px.
     Body text (text-xs through text-base) remains static. */
  --text-lg: clamp(1rem, 0.94rem + 0.16vw, 1.125rem);
  --text-xl: clamp(1.125rem, 1.06rem + 0.16vw, 1.25rem);
  --text-2xl: clamp(1.3125rem, 1.22rem + 0.23vw, 1.5rem);
  --text-3xl: clamp(1.625rem, 1.5rem + 0.31vw, 1.875rem);
  --text-4xl: clamp(2rem, 1.875rem + 0.31vw, 2.25rem);

  /* Border radius */
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

/* Colors use non-inline @theme so Tailwind utilities reference var(--color-*)
   instead of inlining the raw rgb(var(--inner)) expressions. This lets
   CSS.registerProperty() (in register-color-properties.ts) tell browsers
   these are <color> values, enabling smooth interpolation during theme
   transitions — particularly needed for Safari's color property.

   NOTE: The theme variant classes (in theme-variants.generated.css) emit
   resolved --color-* values (e.g., --color-foreground: rgb(245 216 153))
   that intentionally duplicate these @theme definitions with concrete values.
   Safari cannot interpolate registered <color> properties whose value changes
   via var() indirection (rgb(var(--foreground))). The resolved values give
   Safari direct color-to-color transitions it can interpolate. These @theme
   definitions remain as Tailwind's source of truth for utility class generation
   and as fallbacks. See: generate-css-defaults.ts, register-color-properties.ts.
   If Safari gains support for var()-based interpolation on registered properties,
   the resolved values in theme variants can be removed. */
@theme {
  /* Base colors */
  --color-background: rgb(var(--background));
  --color-foreground: rgb(var(--foreground));

  /* Card/Popover (shadcn/ui convention - static containers / floating overlays) */
  --color-card: rgb(var(--card));
  --color-card-foreground: rgb(var(--card-foreground));
  --color-popover: rgb(var(--popover));
  --color-popover-foreground: rgb(var(--popover-foreground));

  /* Surface tokens - mode-aware for layered surfaces
     Use these instead of bg-card/80 or bg-background/80 for consistent hierarchy.
     Supports both opacity and darkening adjustments via CSS variables.
     Base variables (--surface-*-base) allow light mode to swap card/background
     for proper hierarchy (headers lighter than bodies). */
  --color-surface-card: color-mix(
    in oklch,
    rgb(var(--surface-card-base) / var(--surface-opacity)) calc(100% - var(--surface-darken)),
    rgb(var(--foreground)) var(--surface-darken)
  );
  --color-surface-background: color-mix(
    in oklch,
    rgb(var(--surface-background-base) / var(--surface-opacity)) calc(100% - var(--surface-darken)),
    rgb(var(--foreground)) var(--surface-darken)
  );
  --color-surface-muted: color-mix(
    in oklch,
    rgb(var(--muted) / var(--surface-opacity)) calc(100% - var(--surface-darken)),
    rgb(var(--foreground)) var(--surface-darken)
  );
  --color-surface-popover: color-mix(
    in oklch,
    rgb(var(--popover)) calc(100% - var(--surface-darken)),
    rgb(var(--foreground)) var(--surface-darken)
  );

  /* Primary/Secondary/Muted */
  --color-primary: rgb(var(--primary));
  --color-primary-foreground: rgb(var(--primary-foreground));
  /* Primary hover variant - computed per mode:
     Dark mode: opacity-based (subtle, consistent with accent pattern)
     Light mode: color-mix darkening (opacity goes wrong direction) */
  --color-primary-hover: var(--primary-hover-value);
  --color-primary-hover-foreground: rgb(var(--primary-hover-foreground-value));
  --color-secondary: rgb(var(--secondary));
  --color-secondary-foreground: rgb(var(--secondary-foreground));
  --color-muted: rgb(var(--muted));
  --color-muted-foreground: rgb(var(--muted-foreground));

  /* Accent colors */
  --color-accent: rgb(var(--accent));
  --color-accent-foreground: rgb(var(--accent-foreground));
  /* Accent opacity variants - theme-aware (rouge/rose-pine/ayu use higher values) */
  --color-accent-high: rgb(var(--accent) / var(--accent-high-opacity));
  --color-accent-mid: rgb(var(--accent) / var(--accent-mid-opacity));
  --color-accent-low: rgb(var(--accent) / var(--accent-low-opacity));
  --color-accent-high-foreground: rgb(var(--accent-high-foreground));
  --color-accent-mid-foreground: rgb(var(--accent-mid-foreground));
  --color-accent-low-foreground: rgb(var(--accent-low-foreground));
  /* Accent-mid hover variant - computed per mode:
     Dark mode: opacity-based (accent-low equivalent, includes foreground swap)
     Light mode: color-mix darkening (opacity goes wrong direction) */
  --color-accent-mid-hover: var(--accent-mid-hover-value);
  --color-accent-mid-hover-foreground: rgb(var(--accent-mid-hover-foreground-value));
  /* Secondary opacity variants - theme-aware (ayu uses lower value) */
  --color-secondary-high: rgb(var(--secondary) / var(--secondary-high-opacity));
  --color-secondary-mid: rgb(var(--secondary) / var(--secondary-mid-opacity));
  --color-secondary-low: rgb(var(--secondary) / var(--secondary-low-opacity));
  /* Semantic decorative accent - non-interactive visual interest (defaults to primary, themes can override) */
  --color-accent-decorative: rgb(var(--accent-decorative) / var(--accent-decorative-opacity));
  --color-accent-decorative-foreground: rgb(var(--accent-decorative-foreground));
  /* Decorative accents - no foreground pairs (decorative use only) */
  --color-accent-red: rgb(var(--accent-red));
  --color-accent-orange: rgb(var(--accent-orange));
  --color-accent-green: rgb(var(--accent-green));
  --color-accent-blue: rgb(var(--accent-blue));
  --color-accent-purple: rgb(var(--accent-purple));

  /* Destructive */
  --color-destructive: rgb(var(--destructive));
  --color-destructive-foreground: rgb(var(--destructive-foreground));

  /* Borders */
  --color-border: rgb(var(--border));
  --color-border-strong: rgb(var(--border-strong));
  --color-input: rgb(var(--input));
  --color-ring: rgb(var(--ring));

  /* Sidebar colors */
  --color-sidebar: rgb(var(--sidebar));
  --color-sidebar-foreground: rgb(var(--sidebar-foreground));
  --color-sidebar-primary: rgb(var(--sidebar-primary));
  --color-sidebar-primary-foreground: rgb(var(--sidebar-primary-foreground));
  --color-sidebar-accent: rgb(var(--sidebar-accent));
  --color-sidebar-accent-foreground: rgb(var(--sidebar-accent-foreground));
  --color-sidebar-border: rgb(var(--sidebar-border));
  --color-sidebar-ring: rgb(var(--sidebar-ring));

  /* Chart colors */
  --color-chart-1: rgb(var(--chart-1));
  --color-chart-2: rgb(var(--chart-2));
  --color-chart-3: rgb(var(--chart-3));
  --color-chart-4: rgb(var(--chart-4));
  --color-chart-5: rgb(var(--chart-5));
}

:root {
  --radius: 0.625rem;

  /* Surface tokens - controls card/background appearance for layered surfaces
     --surface-opacity: transparency (0-1), higher = more solid
     --surface-darken: mix percentage with foreground (0%-20%), higher = darker/more grounded
     --surface-*-base: which color token to use (light mode swaps these for hierarchy) */
  --surface-opacity: 0.8;
  --surface-darken: 0%;
  --surface-card-base: var(--card);
  --surface-background-base: var(--background);

  /* Window tokens - controls window container background
     --window-bg-opacity: background transparency (0-1), higher = more solid
     --window-darken: mix percentage with foreground (0%-15%), higher = darker window bg */
  --window-bg-opacity: 0.8;
  --window-darken: 0%;

  /* Surface border/shadow tokens - controls visual weight of surface elements
     --surface-border-color: border color (border-strong for light, border for dark)
     --surface-shadow: shadow level (shadow-md for light, none for dark) */
  --surface-border-color: rgb(var(--border));
  --surface-shadow: none;

  /* Accent opacity levels - defaults for most themes (rouge/rose-pine/ayu override) */
  --accent-high-opacity: 0.8;
  --accent-mid-opacity: 0.6;
  --accent-low-opacity: 0.2;
  /* Accent variant foregrounds - defaults based on opacity (high needs contrast, mid/low use foreground) */
  --accent-high-foreground: var(--accent-foreground);
  --accent-mid-foreground: var(--foreground);
  --accent-low-foreground: var(--foreground);
  /* Secondary opacity levels - defaults for most themes (ayu overrides high to 0.6) */
  --secondary-high-opacity: 0.8;
  --secondary-mid-opacity: 0.2;
  --secondary-low-opacity: 0.1;
  /* Hover configuration - computed values differ by mode:
     Dark mode: opacity-based hover (consistent with accent-mid→low pattern)
     Light mode: color-mix darkening (opacity gives wrong visual direction) */
  --primary-hover-value: rgb(var(--primary) / 0.85);
  --primary-hover-foreground-value: var(--primary-foreground);
  --accent-mid-hover-value: rgb(var(--accent) / var(--accent-low-opacity));
  --accent-mid-hover-foreground-value: var(--accent-low-foreground);
  /* Decorative accent - defaults to primary (themes can override for visual variety) */
  --accent-decorative: var(--primary);
  --accent-decorative-foreground: var(--primary-foreground);
  --accent-decorative-opacity: 1;

  /* AUTO-GENERATED THEME DEFAULTS - DO NOT EDIT MANUALLY */
  /* Source: themes["remedy"].dark from src/data/themes */
  /* Base colors */
  --background: 53 43 42;
  --foreground: 245 216 153;

  /* Card colors */
  --card: 61 50 49;
  --card-foreground: 245 216 153;

  /* Popover colors */
  --popover: 61 50 49;
  --popover-foreground: 245 216 153;

  /* Primary colors */
  --primary: 236 112 84;
  --primary-foreground: 53 43 42;

  /* Secondary colors */
  --secondary: 240 198 116;
  --secondary-foreground: 53 43 42;

  /* Muted colors */
  --muted: 61 50 49;
  --muted-foreground: 171 155 124;

  /* Accent colors */
  --accent: 138 190 183;
  --accent-foreground: 53 43 42;

  /* Decorative accents */
  --accent-red: 204 102 102;
  --accent-orange: 235 104 75;
  --accent-green: 181 189 104;
  --accent-blue: 129 162 190;
  --accent-purple: 178 148 187;

  /* Destructive colors */
  --destructive: 212 125 125;
  --destructive-foreground: 53 43 42;

  /* UI elements */
  --border: 74 63 61;
  --border-strong: 110 93 90;
  --input: 61 50 49;
  --ring: 235 104 75;

  /* Shadow tokens */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.2);
  --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.24);
  --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.32);

  /* Layout tokens */
  --content-padding-y: 24px;
  --content-padding-x: 8px;
  /* END AUTO-GENERATED THEME DEFAULTS */
}

/* Theme variant classes are auto-generated into a separate file.
   See: scripts/generate-css-defaults.ts */
@import "./theme-variants.generated.css";

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  html,
  body {
    @apply overflow-hidden;
  }
  body {
    @apply bg-background text-foreground font-body;
  }
}

/* TWM Window Container background
   Token value injected via --window-bg-opacity from WindowContainer component.
   --window-darken mixes foreground color for light mode hierarchy fix. */
[data-window-container] {
  background-color: color-mix(
    in oklch,
    rgb(var(--background) / var(--window-bg-opacity)) calc(100% - var(--window-darken)),
    rgb(var(--foreground)) var(--window-darken)
  );
}

/* Environment Preview toggle for dev pages - when OFF, use full opacity */
html[data-env-preview="false"] [data-window-container] {
  --window-bg-opacity: 1 !important;
}

/* Surface visual definition - border and shadow driven by surface tokens
   Excludes focused elements so focus ring shadows can take precedence */
.bg-surface-card:not(:focus),
.bg-surface-background:not(:focus),
.bg-surface-muted:not(:focus),
.bg-muted:not(:focus) {
  border-color: var(--surface-border-color);
  box-shadow: var(--surface-shadow);
}

/* Scroll shadow affordance gradients
   CSS-only implementation avoids hydration mismatches from useTheme() */
[data-scroll-shadow="top"] {
  background-image: radial-gradient(farthest-side at 50% 0%, rgba(0, 0, 0, 0.15) 0%, transparent 100%);
}

[data-scroll-shadow="bottom"] {
  background-image: radial-gradient(farthest-side at 50% 100%, rgba(0, 0, 0, 0.15) 0%, transparent 100%);
}

/* Dark mode: higher opacity for visibility on dark backgrounds */
.dark [data-scroll-shadow="top"] {
  background-image: radial-gradient(farthest-side at 50% 0%, rgba(0, 0, 0, 0.2) 0%, transparent 100%);
}

.dark [data-scroll-shadow="bottom"] {
  background-image: radial-gradient(farthest-side at 50% 100%, rgba(0, 0, 0, 0.2) 0%, transparent 100%);
}

/* Horizontal scroll shadows (left/right) */
[data-scroll-shadow="left"] {
  background-image: radial-gradient(farthest-side at 0% 50%, rgba(0, 0, 0, 0.15) 0%, transparent 100%);
}

[data-scroll-shadow="right"] {
  background-image: radial-gradient(farthest-side at 100% 50%, rgba(0, 0, 0, 0.15) 0%, transparent 100%);
}

.dark [data-scroll-shadow="left"] {
  background-image: radial-gradient(farthest-side at 0% 50%, rgba(0, 0, 0, 0.2) 0%, transparent 100%);
}

.dark [data-scroll-shadow="right"] {
  background-image: radial-gradient(farthest-side at 100% 50%, rgba(0, 0, 0, 0.2) 0%, transparent 100%);
}

/* TWM Navigation gap - responsive via CSS, no JS needed (prevents hydration flash)
   Mobile: narrower gap for collapsed dropdown nav
   Desktop: wider gap for horizontal nav links */
:root {
  --nav-gap-half: 70px;
}

@media (min-width: 768px) {
  :root {
    --nav-gap-half: 190px;
  }
}

/* TWM Window Container border highlight
   Desktop: hover effect | Touch devices: active (tapped) effect */
@media (hover: hover) {
  [data-window-container]:hover {
    border-color: rgb(var(--primary));
  }
}

@media (hover: none) {
  [data-window-container][data-active="true"] {
    border-color: rgb(var(--primary));
  }
}

/* ==========================================================================
   Light/Dark Mode Transitions
   Smooth color transitions when toggling between light and dark mode.
   Scoped to [data-theme-transition] attribute - applied only during toggle.
   This allows component-specific transitions (opacity, transform) to work
   normally, while ensuring smooth color transitions during theme switch.
   ========================================================================== */

/* Transition resolved --color-* custom properties on <html> itself.
   Combined with CSS.registerProperty() registration (syntax: '<color>'),
   Safari can interpolate these as real colors during theme transitions.
   Handles text color (inherited CSS property) — children inherit the
   smoothly interpolated value without needing their own transition. */
html[data-theme-transition] {
  transition-property:
    --color-background, --color-foreground, --color-card, --color-card-foreground, --color-popover,
    --color-popover-foreground, --color-primary, --color-primary-foreground, --color-secondary,
    --color-secondary-foreground, --color-muted, --color-muted-foreground, --color-accent, --color-accent-foreground,
    --color-accent-high, --color-accent-mid, --color-accent-low, --color-accent-high-foreground,
    --color-accent-mid-foreground, --color-accent-low-foreground, --color-secondary-high, --color-secondary-mid,
    --color-secondary-low, --color-accent-decorative, --color-accent-decorative-foreground, --color-accent-red,
    --color-accent-orange, --color-accent-green, --color-accent-blue, --color-accent-purple, --color-destructive,
    --color-destructive-foreground, --color-border, --color-border-strong, --color-input, --color-ring !important;
  transition-duration: 300ms !important;
  transition-timing-function: ease-out !important;
}

/* Transition concrete color properties on child elements.
   color (text) is omitted — Safari double-transitions it when both the
   custom property on <html> and the concrete property on children transition.
   Text color is handled via --color-foreground interpolation on <html> above.
   fill/stroke omitted — SVG re-rasterization per frame amplifies Safari's
   repaint jitter. Icons inherit color via currentColor which transitions
   through the custom property interpolation on <html>.
   background-color and border-color must remain here: browsers don't
   recalculate non-inherited properties frame-by-frame from transitioning
   ancestor custom properties. */
html[data-theme-transition] *,
html[data-theme-transition] *::before,
html[data-theme-transition] *::after {
  transition-property: background-color, border-color, outline-color, text-decoration-color !important;
  transition-duration: 300ms !important;
  transition-timing-function: ease-out !important;
}

/* Respect reduced motion - instant theme change is acceptable and preferred */
@media (prefers-reduced-motion: reduce) {
  html[data-theme-transition],
  html[data-theme-transition] *,
  html[data-theme-transition] *::before,
  html[data-theme-transition] *::after {
    transition: none !important;
  }
}

/* ==========================================================================
   Page Content Layout
   Mobile-specific padding adjustments for content areas.
   Baseline inline padding is 24px (from layout tokens); reduced on mobile.
   ========================================================================== */

/* Mobile baseline: reduce content top padding for all pages */
@media (max-width: 639px) {
  [data-page-content] {
    padding-top: 12px !important;
  }
}

/* Skills/About - mobile: slightly more padding than baseline */
@media (max-width: 639px) {
  [data-page="skills"] [data-page-content],
  [data-page="about"] [data-page-content] {
    padding-top: 16px !important;
  }
}

/* Projects listing - mobile: further reduced (header provides sufficient spacing) */
@media (max-width: 639px) {
  [data-page="projects"] [data-page-content] {
    padding-top: 8px !important;
  }
}

/* ==========================================================================
   OverlayScrollbars
   Theme styling and page-specific track insets.
   ========================================================================== */

/* Theme: colors and base sizing */
.os-theme-dark.os-scrollbar {
  --os-size: 10px;
  --os-padding-perpendicular: 4px;
  --os-padding-axis: var(--content-padding-y);
  --os-handle-bg: rgb(var(--border-strong) / 0.5);
  --os-handle-bg-hover: rgb(var(--border-strong) / 0.7);
  --os-handle-bg-active: rgb(var(--muted-foreground));
}

/* Stacking context resets */
[data-overlayscrollbars-viewport] {
  z-index: auto !important;
  position: relative !important;
}

.os-scrollbar {
  z-index: 10 !important;
}

/*
 * Track insets (+/- visual tuning)
 * Structure: baseline → page overrides, each with mobile → desktop
 */

/* Baseline (pages with data-page) - mobile */
[data-page] .os-scrollbar-vertical {
  padding-top: 24px;
  padding-bottom: 56px;
}
/* Baseline (pages with data-page) - desktop */
@media (min-width: 768px) {
  [data-page] .os-scrollbar-vertical {
    padding-top: 40px;
    padding-bottom: 64px;
  }
}

/* Project detail - mobile: 165px = DetailHeaderCompact height (~140px) + visual offset */
/* Position from left to push scrollbar 4px outside container (right: -4px doesn't work) */
[data-page="project-detail"] .os-scrollbar-vertical {
  padding-top: 210px;
  right: auto;
  left: calc(100% - 6px); /* 10px wide scrollbar, 4px outside = 100% - 6px */
}
/* Project detail - desktop: 396px = DetailHeader hero height (~360px) + visual offset */
@media (min-width: 768px) {
  [data-page="project-detail"] .os-scrollbar-vertical {
    padding-top: 396px;
    right: 0;
    left: calc(100% - 6px); /* 10px wide scrollbar, 4px outside = 100% - 6px */
  }
}

/* Drawer scrollbars - inset from top/bottom edges */
[data-drawer="skill-filter"] .os-scrollbar-vertical {
  padding-top: 8px;
  padding-bottom: 8px;
}

/* ==========================================================================
   YARL Lightbox - Contained Mode
   Constrain lightbox to the main content window instead of full viewport
   to maintain TWM aesthetic where modals stay within their origin container
   ========================================================================== */

/* Ensure main window container establishes positioning context */
[data-window-id="main"] {
  position: relative;
}

.yarl__root {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100% !important;
  height: 100% !important;
}

/* ==========================================================================
   Intro Animation
   ========================================================================== */

/* Note: Main content and FooterBar visibility during intro is controlled by
   Framer Motion wrappers in LayoutWrapper (Phase 4 layout expansion animation).
   TopBar manages its own visibility via placeholder/actual rendering logic. */

/* Terminal cursor blink */
@keyframes blink {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0;
  }
}

.animate-blink {
  animation: blink 1.06s step-end infinite;
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .animate-blink {
    animation: none;
  }
}

/* ==========================================================================
   Utility Classes
   ========================================================================== */

/* Hide scrollbar while maintaining scroll functionality */
.scrollbar-none {
  -ms-overflow-style: none !important; /* IE and Edge */
  scrollbar-width: none !important; /* Firefox */
}

.scrollbar-none::-webkit-scrollbar {
  display: none !important; /* Chrome, Safari, Opera */
}

/* ==========================================================================
   Horizontal Scroll Fade Masks
   Uses CSS mask-image to fade edges indicating scrollable content.
   Controlled by data-scroll-fade attribute: none | left | right | both
   Fade zone width (24px) must match scroll-padding-inline for proper snap alignment.
   ========================================================================== */

/* Scroll padding utility - offsets snap points to avoid landing under fade zones */
.scroll-padding-inline {
  scroll-padding-inline: 24px;
}

[data-scroll-fade="right"] {
  -webkit-mask-image: linear-gradient(to right, black 0%, black calc(100% - 24px), transparent 100%);
  -moz-mask-image: linear-gradient(to right, black 0%, black calc(100% - 24px), transparent 100%);
  mask-image: linear-gradient(to right, black 0%, black calc(100% - 24px), transparent 100%);
}

[data-scroll-fade="left"] {
  -webkit-mask-image: linear-gradient(to right, transparent 0%, black 24px, black 100%);
  -moz-mask-image: linear-gradient(to right, transparent 0%, black 24px, black 100%);
  mask-image: linear-gradient(to right, transparent 0%, black 24px, black 100%);
}

[data-scroll-fade="both"] {
  -webkit-mask-image: linear-gradient(to right, transparent 0%, black 24px, black calc(100% - 24px), transparent 100%);
  -moz-mask-image: linear-gradient(to right, transparent 0%, black 24px, black calc(100% - 24px), transparent 100%);
  mask-image: linear-gradient(to right, transparent 0%, black 24px, black calc(100% - 24px), transparent 100%);
}
